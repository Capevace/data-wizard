var K=Object.defineProperty;var Z=(t,e,s)=>e in t?K(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s;var g=(t,e,s)=>Z(t,typeof e!="symbol"?e+"":e,s);var G=new Set,u=new WeakMap,E=new WeakMap,S=new WeakMap,$=new WeakMap,tt=new WeakMap,T=new WeakMap,P=new WeakMap,C=new WeakSet,m,B=0,z=0,h="__aa_tgt",A="__aa_del",x="__aa_new",et=t=>{let e=at(t);e&&e.forEach(s=>ct(s))},nt=t=>{t.forEach(e=>{e.target===m&&st(),u.has(e.target)&&k(e.target)})};function ot(t){let e=$.get(t);e?.disconnect();let s=u.get(t),o=0,n=5;s||(s=M(t),u.set(t,s));let{offsetWidth:i,offsetHeight:r}=m,c=[s.top-n,i-(s.left+n+s.width),r-(s.top+n+s.height),s.left-n].map(d=>`${-1*Math.floor(d)}px`).join(" "),l=new IntersectionObserver(()=>{++o>1&&k(t)},{root:m,threshold:1,rootMargin:c});l.observe(t),$.set(t,l)}function k(t){clearTimeout(P.get(t));let e=_(t),s=O(e)?500:e.duration;P.set(t,setTimeout(async()=>{let o=S.get(t);try{await o?.finished,u.set(t,M(t)),ot(t)}catch{}},s))}function st(){clearTimeout(P.get(m)),P.set(m,setTimeout(()=>{G.forEach(t=>U(t,e=>H(()=>k(e))))},100))}function it(t){setTimeout(()=>{tt.set(t,setInterval(()=>H(k.bind(null,t)),2e3))},Math.round(2e3*Math.random()))}function H(t){typeof requestIdleCallback=="function"?requestIdleCallback(()=>t()):requestAnimationFrame(()=>t())}var j,b,rt=typeof window<"u"&&"ResizeObserver"in window;rt&&(m=document.documentElement,j=new MutationObserver(et),b=new ResizeObserver(nt),window.addEventListener("scroll",()=>{z=window.scrollY,B=window.scrollX}),b.observe(m));function at(t){return t.reduce((o,n)=>[...o,...Array.from(n.addedNodes),...Array.from(n.removedNodes)],[]).every(o=>o.nodeName==="#comment")?!1:t.reduce((o,n)=>{if(o===!1)return!1;if(n.target instanceof Element){if(L(n.target),!o.has(n.target)){o.add(n.target);for(let i=0;i<n.target.children.length;i++){let r=n.target.children.item(i);if(r){if(A in r)return!1;L(n.target,r),o.add(r)}}}if(n.removedNodes.length)for(let i=0;i<n.removedNodes.length;i++){let r=n.removedNodes[i];if(A in r)return!1;r instanceof Element&&(o.add(r),L(n.target,r),E.set(r,[n.previousSibling,n.nextSibling]))}}return o},new Set)}function L(t,e){!e&&!(h in t)?Object.defineProperty(t,h,{value:t}):e&&!(h in e)&&Object.defineProperty(e,h,{value:t})}function ct(t){var e;let s=t.isConnected,o=u.has(t);s&&E.has(t)&&E.delete(t),S.has(t)&&((e=S.get(t))===null||e===void 0||e.cancel()),x in t?I(t):o&&s?lt(t):o&&!s?ut(t):I(t)}function f(t){return Number(t.replace(/[^0-9.\-]/g,""))}function dt(t){let e=t.parentElement;for(;e;){if(e.scrollLeft||e.scrollTop)return{x:e.scrollLeft,y:e.scrollTop};e=e.parentElement}return{x:0,y:0}}function M(t){let e=t.getBoundingClientRect(),{x:s,y:o}=dt(t);return{top:e.top+o,left:e.left+s,width:e.width,height:e.height}}function q(t,e,s){let o=e.width,n=e.height,i=s.width,r=s.height,a=getComputedStyle(t);if(a.getPropertyValue("box-sizing")==="content-box"){let l=f(a.paddingTop)+f(a.paddingBottom)+f(a.borderTopWidth)+f(a.borderBottomWidth),d=f(a.paddingLeft)+f(a.paddingRight)+f(a.borderRightWidth)+f(a.borderLeftWidth);o-=d,i-=d,n-=l,r-=l}return[o,i,n,r].map(Math.round)}function _(t){return h in t&&T.has(t[h])?T.get(t[h]):{duration:250,easing:"ease-in-out"}}function J(t){if(h in t)return t[h]}function R(t){let e=J(t);return e?C.has(e):!1}function U(t,...e){e.forEach(s=>s(t,T.has(t)));for(let s=0;s<t.children.length;s++){let o=t.children.item(s);o&&e.forEach(n=>n(o,T.has(o)))}}function X(t){return Array.isArray(t)?t:[t]}function O(t){return typeof t=="function"}function lt(t){let e=u.get(t),s=M(t);if(!R(t))return u.set(t,s);let o;if(!e)return;let n=_(t);if(typeof n!="function"){let i=e.left-s.left,r=e.top-s.top,[a,c,l,d]=q(t,e,s),v={transform:`translate(${i}px, ${r}px)`},p={transform:"translate(0, 0)"};a!==c&&(v.width=`${a}px`,p.width=`${c}px`),l!==d&&(v.height=`${l}px`,p.height=`${d}px`),o=t.animate([v,p],{duration:n.duration,easing:n.easing})}else{let[i]=X(n(t,"remain",e,s));o=new Animation(i),o.play()}S.set(t,o),u.set(t,s),o.addEventListener("finish",k.bind(null,t))}function I(t){x in t&&delete t[x];let e=M(t);u.set(t,e);let s=_(t);if(!R(t))return;let o;if(typeof s!="function")o=t.animate([{transform:"scale(.98)",opacity:0},{transform:"scale(0.98)",opacity:0,offset:.5},{transform:"scale(1)",opacity:1}],{duration:s.duration*1.5,easing:"ease-in"});else{let[n]=X(s(t,"add",e));o=new Animation(n),o.play()}S.set(t,o),o.addEventListener("finish",k.bind(null,t))}function F(t,e){var s;t.remove(),u.delete(t),E.delete(t),S.delete(t),(s=$.get(t))===null||s===void 0||s.disconnect(),setTimeout(()=>{if(A in t&&delete t[A],Object.defineProperty(t,x,{value:!0,configurable:!0}),e&&t instanceof HTMLElement)for(let o in e)t.style[o]=""},0)}function ut(t){var e;if(!E.has(t)||!u.has(t))return;let[s,o]=E.get(t);Object.defineProperty(t,A,{value:!0,configurable:!0});let n=window.scrollX,i=window.scrollY;if(o&&o.parentNode&&o.parentNode instanceof Element?o.parentNode.insertBefore(t,o):s&&s.parentNode?s.parentNode.appendChild(t):(e=J(t))===null||e===void 0||e.appendChild(t),!R(t))return F(t);let[r,a,c,l]=ft(t),d=_(t),v=u.get(t);(n!==B||i!==z)&&pt(t,n,i,d);let p,w={position:"absolute",top:`${r}px`,left:`${a}px`,width:`${c}px`,height:`${l}px`,margin:"0",pointerEvents:"none",transformOrigin:"center",zIndex:"100"};if(!O(d))Object.assign(t.style,w),p=t.animate([{transform:"scale(1)",opacity:1},{transform:"scale(.98)",opacity:0}],{duration:d.duration,easing:"ease-out"});else{let[W,y]=X(d(t,"remove",v));y?.styleReset!==!1&&(w=y?.styleReset||w,Object.assign(t.style,w)),p=new Animation(W),p.play()}S.set(t,p),p.addEventListener("finish",F.bind(null,t,w))}function pt(t,e,s,o){let n=B-e,i=z-s,r=document.documentElement.style.scrollBehavior;if(getComputedStyle(m).scrollBehavior==="smooth"&&(document.documentElement.style.scrollBehavior="auto"),window.scrollTo(window.scrollX+n,window.scrollY+i),!t.parentElement)return;let c=t.parentElement,l=c.clientHeight,d=c.clientWidth,v=performance.now();function p(){requestAnimationFrame(()=>{if(!O(o)){let w=l-c.clientHeight,W=d-c.clientWidth;v+o.duration>performance.now()?(window.scrollTo({left:window.scrollX-W,top:window.scrollY-w}),l=c.clientHeight,d=c.clientWidth,p()):document.documentElement.style.scrollBehavior=r}})}p()}function ft(t){let e=u.get(t),[s,,o]=q(t,e,M(t)),n=t.parentElement;for(;n&&(getComputedStyle(n).position==="static"||n instanceof HTMLBodyElement);)n=n.parentElement;n||(n=document.body);let i=getComputedStyle(n),r=u.get(n)||M(n),a=Math.round(e.top-r.top)-f(i.borderTopWidth),c=Math.round(e.left-r.left)-f(i.borderLeftWidth);return[a,c,s,o]}function Q(t,e={}){return j&&b&&(window.matchMedia("(prefers-reduced-motion: reduce)").matches&&!O(e)&&!e.disrespectUserMotionPreference||(C.add(t),getComputedStyle(t).position==="static"&&Object.assign(t.style,{position:"relative"}),U(t,k,it,n=>b?.observe(n)),O(e)?T.set(t,e):T.set(t,{duration:250,easing:"ease-in-out",...e}),j.observe(t,{childList:!0}),G.add(t))),Object.freeze({parent:t,enable:()=>{C.add(t)},disable:()=>{C.delete(t)},isEnabled:()=>C.has(t)})}function Y(t){t.directive("auto-animate",e=>{Q(e,{disrespectUserMotionPreference:!0})})}var N=class{constructor(e,s){g(this,"bucketId");g(this,"options");g(this,"eventSource");g(this,"messages");g(this,"streamingMessage");g(this,"data");g(this,"tokenStats");this.bucketId=e,this.options=s,this.eventSource=new EventSource(`/api/bucket/${e}/generate?model=claude`),this.eventSource.addEventListener("onDataProgress",o=>{this.streamingMessage=JSON.parse(o.data),this.data=this.streamingMessage.data,this.options.onProgress?.(this.streamingMessage)}),this.eventSource.addEventListener("onData",o=>{let n=JSON.parse(o.data);this.messages.push(n),this.streamingMessage=null,this.options.onMessage?.(n)}),this.eventSource.addEventListener("onErrorMessage",o=>{let n=JSON.parse(o.data),i=n?.error?.title||"Error",r=n?.error?.message||"An unknown error occurred.";this.messages.push(n),this.eventSource.close(),this.eventSource=null,console.error(i,r),this.options.onError?.(new Error(`${i}: ${r}`))}),this.eventSource.addEventListener("onTokenStats",o=>{console.log("onTokenStats",o);let n=JSON.parse(o.data);if(n.tokens&&(this.tokenStats.tokens=n.tokens),n.input_tokens&&(this.tokenStats.inputTokens=n.input_tokens),n.output_tokens&&(this.tokenStats.outputTokens=n.output_tokens),n.cost){let i=n.cost.input_cents_per_1k??0,r=n.cost.output_cents_per_1k??0,a=(n.input_tokens??this.tokenStats.inputTokens??0)/1e3*i,c=(n.output_tokens??this.tokenStats.outputTokens??0)/1e3*r,d=(a+c)/100;console.log("inputCentsPer1k",i),console.log("outputCentsPer1k",r),console.log("inputCostCents",a),console.log("outputCostCents",c),console.log("totalCostsEuro",d),this.tokenStats.cost=`${d.toFixed(3)} \u20AC`}this.options.onTokenStats?.(this.tokenStats)}),this.eventSource.addEventListener("onEnd",o=>{console.log("onEnd",o),this.streamingMessage=null,this.options.onEnd?.(this.tokenStats),this.eventSource.close(),this.eventSource=null}),this.eventSource.onerror=o=>{console.error(o),this.eventSource.close(),this.eventSource=null}}cancel(){this.eventSource.close(),this.eventSource=null}};var V={tokens:"\u2013",inputTokens:"\u2013",outputTokens:"\u2013",cost:"\u2013"};function ht({bucketId:t}){return{source:null,messages:[],streamingMessage:null,tokenStats:{...V},data:null,init(){console.log("init")},stream(){this.messages=[],this.streamingMessage=null,this.tokenStats={...V},this.source=new N(t,{onProgress:e=>{console.log("onProgress",e),this.streamingMessage=e,this.data=e.data},onMessage:e=>{console.log("onMessage",e),this.messages.push(e)},onTokenStats:e=>{console.log("onTokenStats",e),this.tokenStats=e},onEnd:e=>{console.log("onEnd",e),this.tokenStats=e},onError:e=>{console.error("onError",e),window.alert(e.message)}})}}}function D(t){t.data("Generator",ht)}window.addEventListener("alpine:init",()=>{console.info("App initialized"),window.Alpine.plugin(Y),window.Alpine.plugin(D)});
