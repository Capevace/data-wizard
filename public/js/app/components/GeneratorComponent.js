var f=Object.defineProperty;var C=Object.getOwnPropertySymbols;var M=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var g=(n,o,s)=>o in n?f(n,o,{enumerable:!0,configurable:!0,writable:!0,value:s}):n[o]=s,S=(n,o)=>{for(var s in o||(o={}))M.call(o,s)&&g(n,s,o[s]);if(C)for(var s of C(o))_.call(o,s)&&g(n,s,o[s]);return n};var a=(n,o,s)=>g(n,typeof o!="symbol"?o+"":o,s);var p=class{constructor(o){a(this,"sourceUrl");a(this,"options");a(this,"eventSource");a(this,"messages");a(this,"streamingMessage");a(this,"data");a(this,"tokenStats");this.options=o}connect(o){this.setupEventSource(new EventSource(o))}setupEventSource(o){this.eventSource=o,this.eventSource.addEventListener("onDataProgress",s=>{var t,e;this.streamingMessage=JSON.parse(s.data),this.data=this.streamingMessage.data,(e=(t=this.options).onProgress)==null||e.call(t,this.streamingMessage)}),this.eventSource.addEventListener("onData",s=>{var e,r;let t=JSON.parse(s.data);this.messages.push(t),this.streamingMessage=null,(r=(e=this.options).onMessage)==null||r.call(e,t)}),this.eventSource.addEventListener("onErrorMessage",s=>{var i,u,c,l;let t=JSON.parse(s.data),e=((i=t==null?void 0:t.error)==null?void 0:i.title)||"Error",r=((u=t==null?void 0:t.error)==null?void 0:u.message)||"An unknown error occurred.";this.messages.push(t),this.eventSource.close(),this.eventSource=null,console.error(e,r),(l=(c=this.options).onError)==null||l.call(c,new Error(`${e}: ${r}`))}),this.eventSource.addEventListener("onTokenStats",s=>{var e,r,i,u,c,l,k,h;console.log("onTokenStats",s);let t=JSON.parse(s.data);if(t.tokens&&(this.tokenStats.tokens=t.tokens),t.input_tokens&&(this.tokenStats.inputTokens=t.input_tokens),t.output_tokens&&(this.tokenStats.outputTokens=t.output_tokens),t.cost){let v=(e=t.cost.input_cents_per_1k)!=null?e:0,m=(r=t.cost.output_cents_per_1k)!=null?r:0,d=((u=(i=t.input_tokens)!=null?i:this.tokenStats.inputTokens)!=null?u:0)/1e3*v,E=((l=(c=t.output_tokens)!=null?c:this.tokenStats.outputTokens)!=null?l:0)/1e3*m,T=(d+E)/100;console.log("inputCentsPer1k",v),console.log("outputCentsPer1k",m),console.log("inputCostCents",d),console.log("outputCostCents",E),console.log("totalCostsEuro",T),this.tokenStats.cost=`${T.toFixed(3)} \u20AC`}(h=(k=this.options).onTokenStats)==null||h.call(k,this.tokenStats)}),this.eventSource.addEventListener("onEnd",s=>{var t,e;console.log("onEnd",s),this.streamingMessage=null,(e=(t=this.options).onEnd)==null||e.call(t,this.tokenStats),this.eventSource.close(),this.eventSource=null}),this.eventSource.onerror=s=>{console.error(s),this.eventSource.close(),this.eventSource=null}}cancel(){this.eventSource.close(),this.eventSource=null}};var y={tokens:"\u2013",inputTokens:"\u2013",outputTokens:"\u2013",cost:"\u2013"};function P({sourceUrl:n,debugModeEnabled:o}={}){console.log("Generator",n);let s=o?"json":"gui";return{tab:s,source:null,debugModeEnabled:o!=null?o:!1,messages:[],streamingMessage:null,tokenStats:S({},y),data:null,init(){console.log("init"),this.$wire.$watch("actorTab",t=>{t?this.tab="chat":this.tab=s})},startStreaming(t){this.messages=[],this.streamingMessage=null,this.tokenStats=S({},y),this.source=new p({onProgress:e=>{console.log("onProgress",e),this.streamingMessage=e,this.data=e.data},onMessage:e=>{console.log("onMessage",e),this.messages.push(e)},onTokenStats:e=>{console.log("onTokenStats",e),this.tokenStats=e},onEnd:e=>{console.log("onEnd",e),this.tokenStats=e},onError:e=>{console.error("onError",e),window.alert(e.message)}})}}}function w(n){n.data("GeneratorComponent",P)}export{P as GeneratorComponent,w as default};
