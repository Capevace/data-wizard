var g=Object.defineProperty;var S=(o,s,t)=>s in o?g(o,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[s]=t;var n=(o,s,t)=>S(o,typeof s!="symbol"?s+"":s,t);var i=class{constructor(s){n(this,"sourceUrl");n(this,"options");n(this,"eventSource");n(this,"messages");n(this,"streamingMessage");n(this,"data");n(this,"tokenStats");this.options=s}connect(s){this.setupEventSource(new EventSource(s))}setupEventSource(s){this.eventSource=s,this.eventSource.addEventListener("onDataProgress",t=>{this.streamingMessage=JSON.parse(t.data),this.data=this.streamingMessage.data,this.options.onProgress?.(this.streamingMessage)}),this.eventSource.addEventListener("onData",t=>{let e=JSON.parse(t.data);this.messages.push(e),this.streamingMessage=null,this.options.onMessage?.(e)}),this.eventSource.addEventListener("onErrorMessage",t=>{let e=JSON.parse(t.data),r=e?.error?.title||"Error",a=e?.error?.message||"An unknown error occurred.";this.messages.push(e),this.eventSource.close(),this.eventSource=null,console.error(r,a),this.options.onError?.(new Error(`${r}: ${a}`))}),this.eventSource.addEventListener("onTokenStats",t=>{console.log("onTokenStats",t);let e=JSON.parse(t.data);if(e.tokens&&(this.tokenStats.tokens=e.tokens),e.input_tokens&&(this.tokenStats.inputTokens=e.input_tokens),e.output_tokens&&(this.tokenStats.outputTokens=e.output_tokens),e.cost){let r=e.cost.input_cents_per_1k??0,a=e.cost.output_cents_per_1k??0,u=(e.input_tokens??this.tokenStats.inputTokens??0)/1e3*r,c=(e.output_tokens??this.tokenStats.outputTokens??0)/1e3*a,l=(u+c)/100;console.log("inputCentsPer1k",r),console.log("outputCentsPer1k",a),console.log("inputCostCents",u),console.log("outputCostCents",c),console.log("totalCostsEuro",l),this.tokenStats.cost=`${l.toFixed(3)} \u20AC`}this.options.onTokenStats?.(this.tokenStats)}),this.eventSource.addEventListener("onEnd",t=>{console.log("onEnd",t),this.streamingMessage=null,this.options.onEnd?.(this.tokenStats),this.eventSource.close(),this.eventSource=null}),this.eventSource.onerror=t=>{console.error(t),this.eventSource.close(),this.eventSource=null}}cancel(){this.eventSource.close(),this.eventSource=null}};var p={tokens:"\u2013",inputTokens:"\u2013",outputTokens:"\u2013",cost:"\u2013"};function k({sourceUrl:o}={}){return console.log("Generator",o),{tab:"gui",source:null,messages:[],streamingMessage:null,tokenStats:{...p},data:null,init(){console.log("init")},startStreaming(s){this.messages=[],this.streamingMessage=null,this.tokenStats={...p},this.source=new i({onProgress:t=>{console.log("onProgress",t),this.streamingMessage=t,this.data=t.data},onMessage:t=>{console.log("onMessage",t),this.messages.push(t)},onTokenStats:t=>{console.log("onTokenStats",t),this.tokenStats=t},onEnd:t=>{console.log("onEnd",t),this.tokenStats=t},onError:t=>{console.error("onError",t),window.alert(t.message)}})}}}function h(o){o.data("GeneratorComponent",k)}export{k as GeneratorComponent,h as default};
